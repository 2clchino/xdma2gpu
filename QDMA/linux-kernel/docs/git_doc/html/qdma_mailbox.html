

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>QDMA Mailbox &mdash; QDMA Linux Driver 2019.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="QDMA Linux Driver 2019.1 documentation" href="index.html"/>
        <link rel="up" title="QDMA Linux Driver Design Flow" href="qdma_design.html"/>
        <link rel="next" title="QDMA Debug File System Support" href="debugfs.html"/>
        <link rel="prev" title="QDMA Queue Resource Management" href="qdma_resmgmt.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> QDMA Linux Driver
          

          
          </a>

          
            
            
              <div class="version">
                2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="features.html">QDMA Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="system-requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building and Installing Software Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="userguide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-app.html">User Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="devguide.html">Developers Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="qdma_linux_export.html">QDMA Linux Driver Exported APIs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="qdma_design.html">QDMA Linux Driver Design Flow</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#driver-initialization">Driver Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#driver-de-initialization">Driver De-Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#qdma-driver-data-structures">QDMA Driver Data Structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#device-initialization">Device Initialization</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="qdma_design.html#device-de-initialization">Device De-Initialization</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="qdma_design.html#resource-management">Resource Management</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="qdma_design.html#mailbox-communication">Mailbox Communication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#configure-the-queues-for-pf-vf">Configure the Queues for PF/VF</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#add-a-queue">Add a Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#start-a-queue">Start a Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#stop-a-queue">Stop a Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#delete-a-queue">Delete a Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#read-write-from-a-queue">Read/Write from a Queue</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="qdma_usecases.html">QDMA Linux Driver UseCases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">QDMA Performance</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">QDMA Linux Driver</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="devguide.html">Developers Guide</a> &raquo;</li>
      
          <li><a href="qdma_design.html">QDMA Linux Driver Design Flow</a> &raquo;</li>
      
    <li>QDMA Mailbox</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/qdma_mailbox.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="qdma-mailbox">
<h1>QDMA Mailbox<a class="headerlink" href="#qdma-mailbox" title="Permalink to this headline">Â¶</a></h1>
<p>The QDMA Subsystem for PCIe provides an optional feature to support the Single Root I/O
Virtualization (SR-IOV). SR-IOV classifies the functions as:</p>
<ul>
<li><dl class="first docutils">
<dt>Physical Functions (PF) :</dt>
<dd><p class="first last">Full featured PCIe functions which include SR-IOV capabilities among others.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Virtual Functions (VF):</dt>
<dd><p class="first last">PCIe functions featuring configuration space with Base Address
Registers (BARs) but lacking the full configuration resources and are controlled by the PF
configuration. The main role of the VF is data transfer.</p>
</dd>
</dl>
</li>
</ul>
<p>VF can communicate to a PF through mailbox. Each function implements one 128B inbox and 128B outbox message buffer.
These mailboxes are accessible to the driver via PCIe BAR of its own function.
HW also provides ability to interrupt the driver for an incoming mailbox message to a PCIe function.
For further details on the mailbox internals and mailbox registers, refer to <a class="reference external" href="https://www.xilinx.com/support/documentation/ip_documentation/qdma/v3_0/pg302-qdma.pdf">QDMA_Product_Guide</a>.</p>
<p>Physical function (PF) is privileged with full access to QDMA registers and resources, but VFs updates only data handling registers and interrupts.
VF drivers must communicate with the driver attached to the PF through the mailbox for configuration and resource allocation.
The PF and VF drivers define the message formatting to be exchanged between the driver.</p>
<p>The driver enables mailbox interrupt and registers a Rx handler for notification of incoming mailbox message.
It also creates a Tx thread to send a message and poll for its response from the peer driver.</p>
<p>Following are the list of messages supported between PF and VF driver</p>
<div class="highlight-none notranslate"><div class="highlight"><pre>enum mbox_msg_op {
        /** @MBOX_OP_BYE: vf off line */
        MBOX_OP_BYE,
        /** @MBOX_OP_HELLO: vf on line */
        MBOX_OP_HELLO,
        /** @: FMAP programming request */
        MBOX_OP_FMAP,
        /** @MBOX_OP_CSR: global CSR registers request */
        MBOX_OP_CSR,
        /** @MBOX_OP_QREQ: request queues */
        MBOX_OP_QREQ,
        /** @MBOX_OP_QNOTIFY_ADD: notify of queue addition */
        MBOX_OP_QNOTIFY_ADD,
        /** @MBOX_OP_QNOTIFY_DEL: notify of queue deletion */
        MBOX_OP_QNOTIFY_DEL,
        /** @MBOX_OP_QCTXT_WRT: queue context write */
        MBOX_OP_QCTXT_WRT,
        /** @MBOX_OP_QCTXT_RD: queue context read */
        MBOX_OP_QCTXT_RD,
        /** @MBOX_OP_QCTXT_CLR: queue context clear */
        MBOX_OP_QCTXT_CLR,
        /** @MBOX_OP_QCTXT_INV: queue context invalidate */
        MBOX_OP_QCTXT_INV,
        /** @MBOX_OP_INTR_CTXT_WRT: interrupt context write */
        MBOX_OP_INTR_CTXT_WRT,
        /** @MBOX_OP_INTR_CTXT_RD: interrupt context read */
        MBOX_OP_INTR_CTXT_RD,
        /** @MBOX_OP_INTR_CTXT_CLR: interrupt context clear */
        MBOX_OP_INTR_CTXT_CLR,
        /** @MBOX_OP_INTR_CTXT_INV: interrupt context invalidate */
        MBOX_OP_INTR_CTXT_INV,

        /** @MBOX_OP_HELLO_RESP: response to @MBOX_OP_HELLO */
        MBOX_OP_HELLO_RESP = 0x81,
        /** @MBOX_OP_FMAP_RESP: response to @MBOX_OP_FMAP */
        MBOX_OP_FMAP_RESP,
        /** @MBOX_OP_CSR_RESP: response to @MBOX_OP_CSR */
        MBOX_OP_CSR_RESP,
        /** @MBOX_OP_QREQ_RESP: response to @MBOX_OP_QREQ */
        MBOX_OP_QREQ_RESP,
        /** @MBOX_OP_QADD: notify of queue addition */
        MBOX_OP_QNOTIFY_ADD_RESP,
        /** @MBOX_OP_QNOTIFY_DEL: notify of queue deletion */
        MBOX_OP_QNOTIFY_DEL_RESP,
        /** @MBOX_OP_QCTXT_WRT_RESP: response to @MBOX_OP_QCTXT_WRT */
        MBOX_OP_QCTXT_WRT_RESP,
        /** @MBOX_OP_QCTXT_RD_RESP: response to @MBOX_OP_QCTXT_RD */
        MBOX_OP_QCTXT_RD_RESP,
        /** @MBOX_OP_QCTXT_CLR_RESP: response to @MBOX_OP_QCTXT_CLR */
        MBOX_OP_QCTXT_CLR_RESP,
        /** @MBOX_OP_QCTXT_INV_RESP: response to @MBOX_OP_QCTXT_INV */
        MBOX_OP_QCTXT_INV_RESP,
        /** @MBOX_OP_INTR_CTXT_WRT_RESP: response to @MBOX_OP_INTR_CTXT_WRT */
        MBOX_OP_INTR_CTXT_WRT_RESP,
        /** @MBOX_OP_INTR_CTXT_RD_RESP: response to @MBOX_OP_INTR_CTXT_RD */
        MBOX_OP_INTR_CTXT_RD_RESP,
        /** @MBOX_OP_INTR_CTXT_CLR_RESP: response to @MBOX_OP_INTR_CTXT_CLR */
        MBOX_OP_INTR_CTXT_CLR_RESP,
        /** @MBOX_OP_INTR_CTXT_INV_RESP: response to @MBOX_OP_INTR_CTXT_INV */
        MBOX_OP_INTR_CTXT_INV_RESP,

        /** @MBOX_OP_MAX: total mbox opcodes*/
        MBOX_OP_MAX
};
</pre></div>
</div>
<p>The following sequence diagrams shows the mailbox communication between PF and VF for VF configuration.</p>
<img alt="_images/mailbox_communication.png" class="align-center" src="_images/mailbox_communication.png" />
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="debugfs.html" class="btn btn-neutral float-right" title="QDMA Debug File System Support" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="qdma_resmgmt.html" class="btn btn-neutral" title="QDMA Queue Resource Management" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2019, Xilinx, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2019.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>