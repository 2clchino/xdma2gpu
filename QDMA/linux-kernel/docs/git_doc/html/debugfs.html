

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>QDMA Debug File System Support &mdash; QDMA Linux Driver 2019.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="QDMA Linux Driver 2019.1 documentation" href="index.html"/>
        <link rel="up" title="QDMA Linux Driver Design Flow" href="qdma_design.html"/>
        <link rel="next" title="QDMA Linux Driver UseCases" href="qdma_usecases.html"/>
        <link rel="prev" title="QDMA Mailbox" href="qdma_mailbox.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> QDMA Linux Driver
          

          
          </a>

          
            
            
              <div class="version">
                2019.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="features.html">QDMA Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="system-requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building and Installing Software Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="userguide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-app.html">User Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="devguide.html">Developers Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="qdma_linux_export.html">QDMA Linux Driver Exported APIs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="qdma_design.html">QDMA Linux Driver Design Flow</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#driver-initialization">Driver Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#driver-de-initialization">Driver De-Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#qdma-driver-data-structures">QDMA Driver Data Structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#device-initialization">Device Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#device-de-initialization">Device De-Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#configure-the-queues-for-pf-vf">Configure the Queues for PF/VF</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#add-a-queue">Add a Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#start-a-queue">Start a Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#stop-a-queue">Stop a Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="qdma_design.html#delete-a-queue">Delete a Queue</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="qdma_design.html#read-write-from-a-queue">Read/Write from a Queue</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="qdma_design.html#qdma-debug-support">QDMA Debug Support</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="qdma_usecases.html">QDMA Linux Driver UseCases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">QDMA Performance</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">QDMA Linux Driver</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="devguide.html">Developers Guide</a> &raquo;</li>
      
          <li><a href="qdma_design.html">QDMA Linux Driver Design Flow</a> &raquo;</li>
      
    <li>QDMA Debug File System Support</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/debugfs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="qdma-debug-file-system-support">
<h1>QDMA Debug File System Support<a class="headerlink" href="#qdma-debug-file-system-support" title="Permalink to this headline">¶</a></h1>
<p>debugfs is a file system interface, which the kernel drivers uses to expose debug information to the user space. Unlike sysfs, there is no structure or rules on what to publish through this interface.debugfs files are created in /sys/kernel/debug/ folder.</p>
<p>debugfs supports:</p>
<ul class="simple">
<li>Files with assigned file operations. These file interfaces can be either read-only or read/write.</li>
<li>Files to export single integer that can be read-only or read/write</li>
<li>Read-only data blob files.</li>
</ul>
<p>QDMA Kernel driver uses this facility and exposes qdma information similar to <code class="docutils literal notranslate"><span class="pre">dmactl</span></code> user space application. The advantage of debugfs is that users need not depend on user space application but if they integrate the <code class="docutils literal notranslate"><span class="pre">libqdma</span></code> in kernel space driver, it comes along with this debug facility.</p>
<p>During PF/VF module loading, QDMA driver creates PF/VF directories in <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug</span></code> by the names <code class="docutils literal notranslate"><span class="pre">qdma_pf</span></code> and <code class="docutils literal notranslate"><span class="pre">qdma_vf</span></code>. qdma_pf directory will list all the detected primary functions, similarly qdma_vf will list all virtual functions.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre>/sys/kernel/debug/qdma_pf
/sys/kernel/debug/qdma_vf
</pre></div>
</div>
<p>In driver module initialization, during PCIe probe, when a device that is to be handled by QDMA driver is detected, a directory with the name b:d.f format will be created in qdma_&lt;df&gt; directory. Ex: when qdma device 01000 is detected, a directory is created in qdma_pf <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/qdma_pf/01:00.0/</span></code></p>
<p>Below files and directories are created during the device initialization.</p>
<ul class="simple">
<li><strong>info</strong> : This file will give all the information specific to the device. For example, function number, is master PF, Q base and Qmax configured for the device etc.</li>
<li><strong>regs</strong>: This file will dump all the registers corresponding to the device. The registers are the configuration space and user space of the device. These also include global registers, which are common across all the devices.</li>
<li><strong>queues</strong>: This is the directory and is created to hold queues information attached to the device. The qdma_dev_conf structure will also hold pointer to this directory in dbgfs_queues_root, which would help to create queue information when a queue is added to the device.</li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre>/sys/kernel/debug/qdma_pf/01:00.0/info
/sys/kernel/debug/qdma_pf/01:00.0/regs
/sys/kernel/debug/qdma_pf/01:00.0/queues
</pre></div>
</div>
<p>When a queue is added to a QDMA device, per say, through dmactl, a directory with the qid is created in the corresponding <code class="docutils literal notranslate"><span class="pre">queues</span></code> directory of the device. This will be used to create further directories under ‘qid’ directory.</p>
<p>For example, if a queue with qid 2 is added to device qdma01000, the directory with name ‘2’ is created in queues directory</p>
<div class="highlight-none notranslate"><div class="highlight"><pre>/sys/kernel/debug/qdma_pf/01:00.0/queues/2
</pre></div>
</div>
<p>When a queue is added to a QDMA device, a direction directory with the name corresponding to the direction, c2h, h2c and cmpt, is created under qid directory.</p>
<ul class="simple">
<li>If the queue is added in H2C direction, directory with name <code class="docutils literal notranslate"><span class="pre">h2c</span></code> is created in the corresponding qid directory.</li>
<li>If C2H queue is added, then directory with name <code class="docutils literal notranslate"><span class="pre">c2h</span></code> is created in the corresponding queue directory. If C2H queue is added in streaming mode, then a <code class="docutils literal notranslate"><span class="pre">cmpt</span></code> directory is also added to the qid directory.</li>
<li>If queue is added in bidirectional mode, then both <code class="docutils literal notranslate"><span class="pre">c2h</span></code> and <code class="docutils literal notranslate"><span class="pre">h2c</span></code> directories are created in the corresponding qid directory</li>
<li>Lastly, if a bidirectional queues are added in streaming mode, then a ‘cmpt’ directory is also created in the respective qid directory.</li>
</ul>
<p>For example, if a queue with qid 2 is created in bi direction ST, then all c2h, h2c and cmpt directories are created</p>
<div class="highlight-none notranslate"><div class="highlight"><pre>/sys/kernel/debug/qdma_pf/01:00.0/queues/2/h2c
/sys/kernel/debug/qdma_pf/01:00.0/queues/2/c2h
/sys/kernel/debug/qdma_pf/01:00.0/queues/2/cmpt
</pre></div>
</div>
<ul class="simple">
<li><strong>info</strong>: This file holds the information specific to the queue, for example if queue is on line etc</li>
<li><strong>cntxt</strong>: This file will dump the contexts corresponding the queue. <code class="docutils literal notranslate"><span class="pre">cntxt</span></code> in <code class="docutils literal notranslate"><span class="pre">cmpt</span></code> directory will only dump the C2H ST completion context.</li>
<li><strong>desc</strong>:  This file will dump the descriptor contents of the ring.</li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre>/sys/kernel/debug/qdma_pf/01:00.0/queues/2/h2c/info
/sys/kernel/debug/qdma_pf/01:00.0/queues/2/h2c/cntxt
/sys/kernel/debug/qdma_pf/01:00.0/queues/2/h2c/desc
</pre></div>
</div>
<p>use <code class="docutils literal notranslate"><span class="pre">cat</span></code> command for displaying the contents of these leaf node debug files. Example is provided below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre>[xilinx@]# cat cntxt
SOFTWARE CTXT:
                Interrupt Aggregation                           0x1        1
                Ring Index                                      0x0        0
                Descriptor Ring Base Addr (High)                0x0        0
                Descriptor Ring Base Addr (Low)                 0x34048000 872710144
                Is Memory Mapped                                0x0        0
                Marker Disable                                  0x0        0
                IRQ Request                                     0x0        0
                Writeback Error Sent                            0x0        0
                Error                                           0x0        0
                Interrupt No Last                               0x0        0
                Port Id                                         0x0        0
                Interrupt Enable                                0x1        1
                Writeback Enable                                0x1        1
                MM Channel                                      0x0        0
                Bypass Enable                                   0x0        0
                Descriptor Size                                 0x1        1
                Ring Size                                       0x9        9
                Fetch Max                                       0x0        0
                Address Translation                             0x0        0
                Write back/Intr Interval                        0x1        1
                Write back/Intr Check                           0x1        1
                Fetch Credit Enable                             0x0        0
                Queue Enable                                    0x1        1
                Function Id                                     0x0        0
                IRQ Arm                                         0x1        1
                PIDX                                            0x40a      1034

HARDWARE CTXT:
                Fetch Pending                                   0x0        0
                Eviction Pending                                0x0        0
                Queue Invalid No Desc Pending                   0x1        1
                Descriptors Pending                             0x1        1
                Credits Consumed                                0x0        0
                CIDX                                            0x40a      1034
</pre></div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="qdma_usecases.html" class="btn btn-neutral float-right" title="QDMA Linux Driver UseCases" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="qdma_mailbox.html" class="btn btn-neutral" title="QDMA Mailbox" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2019, Xilinx, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2019.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>